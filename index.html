<!DOCTYPE html>
<html>
<head>
	<title>DATABASE_melbo</title>
	<link rel="stylesheet" href="index.css">
	<script src="jq.js"></script>
	<script src="papaparse.min.js"></script>
</head>
<body>
	<section id="home">
	<p>DATABASE ONLINE...</p>
	<p>FOUND <a id="gameAmount"></a> GAMES</p>
	<p>TYPE 'GAME' + <kbd>Enter</kbd> TO SEARCH</p>
	</section>
	
	<section id="games">
	<table id="table">
	</table>
	</section>
	
	<p id="errorMsg"></p>
	<span class="cmd">USER:/<input type="text"></input></span>
<script>
//textTyper
(function(e){"use strict";e.fn.textTyper=function(t){var n={typingClass:"typing",beforeAnimation:function(){},afterAnimation:function(){},speed:70,nextLineDelay:400,startsFrom:0,repeatAnimation:false,repeatDelay:4e3,repeatTimes:1,cursorHtml:'<span class="cursor">|</span>'},r=e.extend({},n,t);this.each(function(){var t=e(this),n=1,i="typingCursor";var s=t,o=s.length,u=[];while(o--){u[o]=e.trim(e(s[o]).html());e(s[o]).html("")}t.init=function(e){var n=r.beforeAnimation;if(n)n();t.animate(0)};t.animate=function(o){var a=s[o],f=r.typingClass,l=r.startsFrom;e(a).addClass(f);var c=setInterval(function(){var f=r.cursorHtml;f=e("<div>").append(e(f).addClass(i)).html();e(a).html(u[o].substr(0,l)+f);l++;if(u[o].length<l){clearInterval(c);o++;if(s[o]){setTimeout(function(){e(a).html(u[o-1]);t.animate(o)},r.nextLineDelay)}else{e(a).find("."+i).remove();if(r.repeatAnimation&&(r.repeatTimes==0||n<r.repeatTimes)){setTimeout(function(){t.animate(0);n++},r.repeatDelay)}else{var h=r.afterAnimation;if(h)h()}}}},r.speed)};t.init()});return this}})(jQuery)

$(document).ready(function(){

	$("#games").hide();
	loadGames(); //Parsing .CSV file into the #games table.
	
});

function loadComplete(){ //Starts after parsing .CSV
	
	//INITIALIZATION
	$("#gameAmount").html($('#table tr').length.toString()); //Inserts amount of games
	$(".cmd").hide();
	$("input[type='text']").focus();
	$("#home").textTyper({
		speed:30,
		afterAnimation:function(){
			$(".cmd").fadeIn();
			$("input[type='text']").focus();
			$("input[type='text']").val("");
		}
	});
	
	//SWITCHING
	$("input[type='text']").keyup(function(e){
		if(e.which == 13){
			$("#home").hide();
			$("#errorMsg").hide();
			$(".cmd").hide();
			
			if($("input[type='text']").val() == ""){ //On empty input
				$("#games").hide();
				$("#errorMsg").show();
				$("#errorMsg").text("ERROR: EMPTY INPUT");
				$("#errorMsg").textTyper({afterAnimation:function(){
					$(".cmd").fadeIn();
					$("input[type='text']").focus();
					$("input[type='text']").val("");
				}});
			}
			else{ //On game input
				$("#games").show();
				var cmdinput = $("input[type='text']").val().toUpperCase();
				var foundGame = false
				$('#table tr').each(function(){
					game = $(this).find("td").html().toUpperCase();
					reg = new RegExp(cmdinput);
					if(game.match(reg) == null){
						$(this).hide()
					}
					else if(game.match(reg) != null){
						foundGame = true
						$(this).show();
					}
				});
				if(!foundGame){ //Game not found
					$("#errorMsg").show();
					$("#errorMsg").text("ERROR: " + $("input[type='text']").val() + " NOT FOUND");
					$("#errorMsg").textTyper({afterAnimation:function(){
						$(".cmd").fadeIn();
						$("input[type='text']").focus();
						$("input[type='text']").val("");
					}});
				}
				$("#games tr:visible").textTyper({
					speed:50,
					afterAnimation:function(){
						$(".cmd").fadeIn();
						$("input[type='text']").focus();
						$("input[type='text']").val("");
					}
				});
				$("input[type='text']").focus();
				$("input[type='text']").val('');
			}
		}
	});
}

function loadGames(){
	var games = [];
	var link = "https://raw.githubusercontent.com/m-e-l-b-o/the-list/master/list.csv"
	Papa.parse(link, {
	download: true,
    complete: function(results){
      for(n = 2; n < results.data.length;n++){
        games.push({
          rating: results.data[n][0],
          name: results.data[n][1],
          platform: results.data[n][2],
          time: results.data[n][3]
        });
      }
      for(n = 0;n < games.length;n++){
        var node = document.createElement("TR")
        var game = document.createTextNode(games[n].name)
        var platform = document.createTextNode(games[n].platform)
        var rating = document.createTextNode(games[n].rating)
        var time = document.createTextNode(games[n].time)
        var td1 = document.createElement("TD")
        var td2 = document.createElement("TD")
        var td3 = document.createElement("TD")
        var td4 = document.createElement("TD")
        node.appendChild(td1)
        td1.appendChild(game)
        node.appendChild(td2)
        td2.appendChild(platform)
        td2.style.textAlign = "center"
        node.appendChild(td3)
        td3.appendChild(rating)
        node.appendChild(td4)
        td4.appendChild(time)
		td4.style.textAlign = "center"
        document.getElementById("table").appendChild(node)
      }
	loadComplete();
    }
  });
}
</script>
</body>
</html>
