<!DOCTYPE html>
<html>
<head>
	<title>DATABASE_melbo</title>
	<link rel="stylesheet" href="index.css">
	<script src="jq.js"></script>
	<script src="textTyper.js"></script>
	<script src="papaparse.min.js"></script>
</head>
<body>
	<section id="home">
	<p>DATABASE ONLINE...</p>
	<p>FOUND <a id="gameAmount"></a> GAMES</p>
	<p>TYPE 'GAME' + <kbd>Enter</kbd> TO SEARCH</p>
	</section>
	
	<section id="games">
	<table id="table">
	</table>
	</section>
	
	<span class="cmd">USER:/<input type="text"></input></span>
<script>
$(document).ready(function(){

	$("#games").hide();
	loadGames(); //Parsing .CSV file into the #games table.
	
});

function loadComplete(){ //Starts after parsing .CSV
	
	//INITIALIZATION
	$("#gameAmount").html($('#table tr').length.toString()); //Inserts amount of games
	$(".cmd").hide();
	$("input[type='text']").focus();
	$("#home").addClass('open');
	$("#home").textTyper({
		speed:30,
		afterAnimation:function(){
			$(".cmd").fadeIn();
			$("input[type='text']").focus();
			$("input[type='text']").val("");
		}
	});
	var sectionArray = []; //Makes list of section ids
	$('section').each(function(i,e) {
		sectionArray.push($(e).attr('id'));
	});
	
	//SWITCHING
	$("input[type='text']").keyup(function(e){
		if(e.which == 13){
			$("#home").hide();
			$(".cmd").hide();
			$("#games").show();
			var cmdinput = $("input[type='text']").val().toUpperCase();
			$('#table tr').each(function(){
				game = $(this).find("td").html().toUpperCase();
				reg = new RegExp(cmdinput);
				if(game.match(reg) == null){
					$(this).hide()
				}
				else if(game.match(reg) != null){
					$(this).show();
				}
			});
			$("#games tr:visible").textTyper({
				speed:50,
				afterAnimation:function(){
					$(".cmd").fadeIn();
					$("input[type='text']").focus();
					$("input[type='text']").val("");
				}
			});
			$("input[type='text']").focus();
			$("input[type='text']").val('');
		}
	});
}

function loadGames(){
	var games = [];
	var link = "https://raw.githubusercontent.com/m-e-l-b-o/the-list/master/list.csv"
	Papa.parse(link, {
	download: true,
    complete: function(results){
      for(n = 2; n < results.data.length;n++){
        games.push({
          rating: results.data[n][0],
          name: results.data[n][1],
          platform: results.data[n][2],
          time: results.data[n][3]
        });
      }
      for(n = 0;n < games.length;n++){
        var node = document.createElement("TR")
        var game = document.createTextNode(games[n].name)
        var platform = document.createTextNode(games[n].platform)
        var rating = document.createTextNode(games[n].rating)
        var time = document.createTextNode(games[n].time)
        var td1 = document.createElement("TD")
        var td2 = document.createElement("TD")
        var td3 = document.createElement("TD")
        var td4 = document.createElement("TD")
        node.appendChild(td1)
        td1.appendChild(game)
        node.appendChild(td2)
        td2.appendChild(platform)
        td2.style.textAlign = "center"
        node.appendChild(td3)
        td3.appendChild(rating)
        node.appendChild(td4)
        td4.appendChild(time)
        document.getElementById("table").appendChild(node)
      }
	loadComplete();
    }
  });
}
</script>
</body>
</html>
