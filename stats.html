<!DOCTYPE html>
<html>
<head>
  <title>~~</title>
  <link rel="stylesheet" href="index.css">
  <script src="jq.js"></script>
  <script src="papaparse.min.js"></script>
  <script src="chart.js"></script>
</head>
<body>
  <div id="center">
  <h1 id="title">Statistics</h1>

  <p id="link"><a href="index.html">List</a></p>

  <div id="separator">
  </div>

  <h2>Number of games per rating</h3>
  <canvas class="chart" id="ratingChart"></canvas>

  <p>Average rating: <p class="averageRating"></p></p>

  </div>

<script>
games = [], ratings = [], names = [], platforms = [], times = []
var link = "https://raw.githubusercontent.com/m-e-l-b-o/the-list/master/GAMES.csv"
Papa.parse(link, {
  download: true,
  complete: function(results){
    //List parsing
    for(n=2;n<results.data.length;n++){
      games.push({
        rating: results.data[n][0],
        name: results.data[n][1],
        platform: results.data[n][2],
        time: results.data[n][3]
      });
    }
    for(i=0;i<games.length;i++){
      ratings.push(parseInt(games[i].rating))
      names.push(games[i].name)
      platforms.push(games[i].platform)
      times.push(games[i].time)
    }

    //Funcs
    function getRatingAmount(){
      var counts = [0,0,0,0,0,0,0,0,0,0]
      for(i=0;i<ratings.length;i++){
        for(j=0;j<10;j++){
          console.log(j)
          if(ratings[i] == j+1){
            counts[j] += 1
          }
        }
      }
      return counts
    }

    //Inserting values
    var sum = 0
    for(i=0;i<ratings.length;i++){
      sum += ratings[i]
    }
    $(".averageRating").html(sum/ratings.length)

    //Charts
    var ratingChart = new Chart(document.getElementById("ratingChart").getContext("2d"),{
      type: "bar",
      data: {
        labels: ["1","2","3","4","5","6","7","8","9","10"],
        datasets: [{
          label: "# of games",
          data: getRatingAmount(), //[1,2,3,4,...]
          backgroundColor: getColors(10) //"rgba(153,255,0,0.2)","rgba(123,231,234,1),..."
        }]
      }
    })

    //end of "complete"
  }
});

//List independent functions
function getColors(n){
  var colors = [
    "rgba(63,191,127,0.4)",
    "rgba(63,191,191,0.4)",
    "rgba(63,127,191,0.4)",
    "rgba(63,63,191,0.4)",
    "rgba(127,63,191,0.4)",
    "rgba(191,63,191,0.4)",
    "rgba(191,63,127,0.4)",
    "rgba(191,63,63,0.4)",
    "rgba(191,127,63,0.4)",
    "rgba(191,191,63,0.4)"
  ]
  return colors.slice(0,n)
}
/* This takes n colors from a selection of max 10. I plan
to replace this with an algorithm which gets n equidistant
hues in HSL and converts it to RGB. That way I might be
able to produce n "distinct" colors.
HSL to RGB conversion on Wikipedia */

</script>
</body>
</html>
